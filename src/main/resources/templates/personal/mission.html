<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>개인 미션 • 탄소중립</title>
    <link rel="stylesheet" th:href="@{/personal/mission.css}" />
</head>
<body>

<link rel="stylesheet" th:href="@{/nav.css}" />
<link rel="stylesheet" th:href="@{/home/home.css}" />



<header class="site-header">
    <div class="inner">
        <!-- 좌: 브랜드 -->
        <a class="brand" href="/user">춘천지켜봄</a>

        <!-- 가운데: 메뉴 -->
        <nav class="nav-links">
            <a class="nav-link" href="/trash/reportPage"
               th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.matches('.*/trash/reportPage.*')} ? ' active' : ''">
                지도
            </a>
            <a class="nav-link" href="/personal/missionPage"
               th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.matches('.*/personal/.*')} ? ' active' : ''">
                참여
            </a>
            <a class="nav-link" href="/center"
               th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.matches('.*/center.*')} ? ' active' : ''">
                센터
            </a>
            <a class="nav-link" href="/info"
               th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI.matches('.*/info.*')} ? ' active' : ''">
                정보
            </a>
        </nav>

        <!-- 우: 로그인/사용자 -->
        <div class="auth">
            <!-- 로그인 전 -->
            <a class="btn" th:if="${#strings.isEmpty(session.user_id)}" th:href="@{/user/login}">로그인</a>

            <!-- 로그인 후 -->
            <div th:unless="${#strings.isEmpty(session.user_id)}" style="display:flex; gap:8px;">
                <a class="btn" th:href="@{/user/myPage}">내 정보</a>
                <a class="btn primary" th:href="@{/user/logOut}">로그아웃</a>
            </div>
        </div>
    </div>
</header>

<!-- (옵션) 모바일 하단 네비 -->
<nav class="bottom-nav" aria-label="하단 네비게이션">
    <div class="bn-inner">
        <a class="bn-item" href="/trash/reportPage">
            <span class="ic">🗺️</span><span>지도</span>
        </a>
        <a class="bn-item" href="/personal/missionPage">
            <span class="ic">🤝</span><span>참여</span>
        </a>
        <a class="bn-item" href="/center">
            <span class="ic">🏛️</span><span>센터</span>
        </a>
        <a class="bn-item" th:href="${#strings.isEmpty(session.user_id)} ? @{/user/login} : @{/user/myPage}">
            <span class="ic">ℹ️</span>
            <span th:text="${#strings.isEmpty(session.user_id)} ? '로그인' : '정보'">정보</span>
        </a>
    </div>
</nav>


<div class="safe"></div>


<script th:inline="javascript">
  window.MISSIONS = /*[[${missions}]]*/ [];
</script>

<div class="title-wrap">
<h1>보너스 포인트 받는<br/>미션 모아봤어요</h1>
<p class="subtitle">탄소중립 실천으로 포인트를 모아봐요</p>
</div>

<main class="grid" id="grid"></main>


    <!-- 미션 상세 모달 -->
    <div class="modal" id="missionModal">
      <div class="overlay" data-close="mission" aria-hidden="true"></div>
      <div
        class="sheet center"
        role="dialog"
        aria-modal="true"
        aria-labelledby="mTitle"
      >
        <div class="m-head">
          <div class="m-title" id="mTitle">미션 상세</div>
          <button class="close" data-close="mission" aria-label="닫기">
            ✕
          </button>
        </div>
        <div class="m-body">
          <div id="mMeta" class="meta"></div>
          <div id="mDesc" class="desc"></div>
          <div class="row-actions">
            <button class="btn" data-close="mission">나중에</button>
            <button class="btn primary" id="btnStart">도전하기</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 업로드 모달 -->
    <div class="modal" id="uploadModal">
      <div class="overlay" data-close="upload" aria-hidden="true"></div>
      <div
        class="sheet"
        role="dialog"
        aria-modal="true"
        aria-labelledby="uMissionTitle"
      >
        <div class="m-head">
          <div class="m-title"><span id="uMissionTitle">미션 인증</span></div>
          <button class="close" data-close="upload" aria-label="닫기">✕</button>
        </div>
        <div class="m-body">
          <div class="badge primary" id="uPoints" aria-live="polite">+ 50p</div>
          <div class="drop" id="dropzone">
            <input
              type="file"
              id="uFile"
              accept="image/*"
              capture="environment"
              aria-label="인증 사진 업로드"
            />
            <div class="hint">사진을 드래그하거나 탭해서 업로드</div>
          </div>
          <div class="preview" id="uPreview">
            <img alt="업로드 미리보기" />
          </div>
          <textarea
            id="uMemo"
            placeholder="미션을 인증할 간단한 메모를 남겨주세요."
            aria-label="미션 메모"
          ></textarea>
          <div class="row-actions">
            <button class="btn" data-close="upload">취소</button>
            <button class="btn primary" id="uSubmit">
              업로드하고 미션 완료하기
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- 페이지 전용 스크립트 -->
    <script type="module" th:src="@{/personal/mission.js}"></script>
  </body>
</html>
