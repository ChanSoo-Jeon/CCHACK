<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Loginpage</title>
    <link
            href="https://fonts.googleapis.com/css?family=Karla:400,700&display=swap"
            rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdn.materialdesignicons.com/4.8.95/css/materialdesignicons.min.css">
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

    <style>
        #auth-page{
            --brand:#2563eb; --ink:#111; --muted:#6b7280; --line:#e5e7eb; --card:#fff; --bg:#f9fafb;
            font-family: "Karla", system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
            color:var(--ink); background:var(--bg); min-height:100vh;
        }
        #auth-page .ap-shell{min-height:100vh}

        /* ===== Aside (좌측) ===== */
        #auth-page .ap-aside{position:relative; align-items:flex-end; overflow:hidden}
        #auth-page .ap-img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover}
        #auth-page .ap-overlay{position:absolute; inset:0; background:linear-gradient(120deg, rgba(37,99,235,.65), rgba(37,99,235,.15))}
        #auth-page .ap-aside-inner{position:relative; z-index:2; padding:48px; color:#fff; max-width:520px}
        #auth-page .ap-badge{display:inline-block; background:rgba(255,255,255,.18); border:1px solid rgba(255,255,255,.35); color:#fff;
            padding:6px 12px; border-radius:999px; font-weight:700; margin-bottom:14px; backdrop-filter: blur(4px);}
        #auth-page .ap-aside h2{font-weight:800; line-height:1.2; margin:0 0 8px}
        #auth-page .ap-aside p{opacity:.9; margin:0}

        /* ===== Right Pane / Card ===== */
        #auth-page .ap-pane{display:flex; align-items:center; justify-content:center; padding:32px}
        #auth-page .ap-card{width:100%; max-width:520px; background:var(--card); border:1px solid var(--line);
            border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,.06); padding:24px 24px 28px}

        /* Tabs */
        #auth-page .ap-tabs{display:flex; gap:8px; margin-bottom:14px}
        #auth-page .ap-tab{
            flex:1; padding:14px 12px; border-radius:12px; border:1px solid var(--line); background:#fff;
            font-weight:800; letter-spacing:.5px; color:var(--muted); transition:.2s; cursor:pointer;
        }
        #auth-page .ap-tab.active{color:#fff; background:var(--brand); border-color:var(--brand); box-shadow:0 8px 20px rgba(37,99,235,.25)}
        #auth-page .ap-tab:disabled{cursor:default}

        /* Form */
        #auth-page .ap-form{margin-top:8px}
        #auth-page .ap-grid{display:grid; grid-template-columns:1fr 1fr; gap:14px}
        @media (max-width: 992px){ #auth-page .ap-grid{grid-template-columns:1fr} }

        #auth-page .ap-field label{font-size:14px; color:var(--muted); margin-bottom:6px}
        #auth-page .ap-input{position:relative}
        #auth-page .ap-input i.mdi{position:absolute; left:12px; top:50%; transform:translateY(-50%); opacity:.6}
        #auth-page .ap-input .form-control{padding-left:40px; height:44px; border-radius:12px; border:1px solid var(--line)}
        #auth-page .ap-input .form-control:focus{box-shadow:none; border-color:var(--brand)}
        #auth-page .ap-chip{
            position:absolute; right:6px; top:6px; height:32px; padding:0 10px; border-radius:999px;
            border:1px solid var(--line); background:#f8fafc; color:#111; font-size:12px;
        }

        #auth-page .ap-radio-row{display:flex; gap:14px; align-items:center}
        #auth-page .ap-eye{
            position:absolute; right:6px; top:6px; width:32px; height:32px; display:grid; place-items:center;
            border:none; background:transparent; color:#6b7280;
        }

        #auth-page .ap-btn{display:inline-flex; align-items:center; justify-content:center; gap:8px;
            height:46px; border-radius:12px; border:1px solid var(--line); background:#fff; font-weight:700}
        #auth-page .ap-btn:hover{filter:brightness(.98)}
        #auth-page .ap-primary{background:var(--brand); color:#fff; border-color:var(--brand)}
        #auth-page .ap-hint{margin:12px 0 0; color:var(--muted); text-align:center}
        #auth-page .ap-hint a{color:var(--brand); text-decoration:none}

    </style>
</head>
<body>


<div id="auth-page" class="container-fluid">
    <div class="ap-shell row no-gutters">
        <!-- 왼쪽 비주얼 -->
        <aside class="ap-aside d-none d-lg-flex col-lg-6">
            <div class="ap-aside-inner">
                <div class="ap-badge">춘천지켜봄</div>
                <h2>친환경 생활, 오늘부터 가볍게</h2>
                <p>참여하고, 포인트도 모으고, 우리 동네가 바뀌는 걸 지켜보세요.</p>
            </div>
            <div class="ap-overlay"></div>
        </aside>

        <!-- 오른쪽 폼 카드 -->
        <section class="ap-pane col-12 col-lg-6">
            <div class="ap-card">
                <!-- 탭 -->
                <div class="ap-tabs">
                    <button id="loginButton" class="ap-tab active" onclick="signIn()" disabled>SIGN IN</button>
                    <button id="signupButton" class="ap-tab" onclick="signUp()">SIGN UP</button>
                </div>

                <!-- 로그인 -->
                <div id="loginPage">
                    <form id="loginForm" action="/user/loginProc" method="post" class="ap-form">
                        <div class="ap-field">
                            <label for="user_id">아이디</label>
                            <div class="ap-input">
                                <i class="mdi mdi-account-outline"></i>
                                <input name="user_id" id="user_id" class="form-control" placeholder="enter your ID">
                            </div>
                        </div>

                        <div class="ap-field">
                            <label for="user_pwd">비밀번호</label>
                            <div class="ap-input">
                                <i class="mdi mdi-lock-outline"></i>
                                <input type="password" name="user_pwd" id="user_pwd" class="form-control" placeholder="enter your password">
                                <button type="button" class="ap-eye" data-target="#user_pwd"><i class="mdi mdi-eye-outline"></i></button>
                            </div>
                        </div>

                        <button type="submit" class="ap-btn ap-primary w-100">로그인</button>
                        <p class="ap-hint">처음이신가요? <a href="javascript:void(0)" onclick="signUp()">회원가입</a></p>
                    </form>
                </div>

                <!-- 회원가입 -->
                <div id="signupPage" style="display:none">
                    <form class="ap-form" onsubmit="return false;">
                        <div class="ap-grid">
                            <div class="ap-field">
                                <label for="user_signup_id">아이디</label>
                                <div class="ap-input">
                                    <i class="mdi mdi-account-plus-outline"></i>
                                    <input id="user_signup_id" class="form-control" placeholder="enter your ID">
                                    <button type="button" id="btnCheckId" class="ap-chip" onclick="checkId()">중복확인</button>
                                </div>
                                <small id="idHelp" class="form-text"></small>
                                <input type="hidden" id="idChecked" value="false">
                            </div>

                            <div class="ap-field">
                                <label for="user_signup_pwd">비밀번호</label>
                                <div class="ap-input">
                                    <i class="mdi mdi-lock-outline"></i>
                                    <input type="password" id="user_signup_pwd" class="form-control" placeholder="enter your password">
                                    <button type="button" class="ap-eye" data-target="#user_signup_pwd"><i class="mdi mdi-eye-outline"></i></button>
                                </div>
                            </div>

                            <div class="ap-field">
                                <label for="user_signup_checkpwd">비밀번호 재확인</label>
                                <div class="ap-input">
                                    <i class="mdi mdi-lock-check-outline"></i>
                                    <input type="password" id="user_signup_checkpwd" class="form-control" placeholder="check your password">
                                    <button type="button" class="ap-eye" data-target="#user_signup_checkpwd"><i class="mdi mdi-eye-outline"></i></button>
                                </div>
                            </div>

                            <div class="ap-field">
                                <label for="user_nick_name">닉네임</label>
                                <div class="ap-input">
                                    <i class="mdi mdi-account-heart-outline"></i>
                                    <input id="user_nick_name" class="form-control" placeholder="예: 그린워커">
                                </div>
                            </div>

                            <div class="ap-field">
                                <label class="d-block">출퇴근 시 자차 이용 여부</label>
                                <div class="ap-radio-row">
                                    <label><input type="radio" name="commute_by_car" value="true"> 예</label>
                                    <label><input type="radio" name="commute_by_car" value="false" checked> 아니오</label>
                                </div>
                            </div>

                            <div class="ap-field">
                                <label for="cafe_use_freq">카페 이용 빈도</label>
                                <select id="cafe_use_freq" class="form-control">
                                    <option value="" selected disabled>선택하세요</option>
                                    <option>거의 안 감</option><option>월1~2회</option><option>주1~2회</option><option>주3회 이상</option>
                                </select>
                            </div>

                            <div class="ap-field">
                                <label for="grocery_freq">장보기 빈도</label>
                                <select id="grocery_freq" class="form-control">
                                    <option value="" selected disabled>선택하세요</option>
                                    <option>거의 안 감</option><option>월1회</option><option>주1회</option><option>주2회 이상</option>
                                </select>
                            </div>

                            <div class="ap-field">
                                <label class="d-block">에너지 절약 실천 여부</label>
                                <div class="ap-radio-row">
                                    <label><input type="radio" name="practice_energy_saving" value="true"> 예</label>
                                    <label><input type="radio" name="practice_energy_saving" value="false" checked> 아니오</label>
                                </div>
                            </div>

                            <div class="ap-field">
                                <label for="residence_dong">거주 행정동</label>
                                <input id="residence_dong" class="form-control" placeholder="예: 효자동">
                            </div>

                            <div class="ap-field">
                                <label for="workplace_or_school_dong">직장/학교 행정동</label>
                                <input id="workplace_or_school_dong" class="form-control" placeholder="예: 석사동">
                            </div>
                        </div>

                        <button class="ap-btn ap-primary w-100" onclick="signupProc()">회원가입</button>
                        <p class="ap-hint">이미 계정이 있나요? <a href="javascript:void(0)" onclick="signIn()">로그인</a></p>
                    </form>
                </div>
            </div>
        </section>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script
        src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
    // 탭 토글 (기존 signIn/signUp 유지)
    function signIn(){
        document.getElementById('loginPage').style = "";
        document.getElementById('signupPage').style = "display:none";
        document.getElementById('loginButton').classList.add('active');
        document.getElementById('signupButton').classList.remove('active');
        document.getElementById('loginButton').disabled = true;
        document.getElementById('signupButton').disabled = false;
    }
    function signUp(){
        document.getElementById('loginPage').style = "display:none";
        document.getElementById('signupPage').style = "";
        document.getElementById('signupButton').classList.add('active');
        document.getElementById('loginButton').classList.remove('active');
        document.getElementById('loginButton').disabled = false;
        document.getElementById('signupButton').disabled = true;
    }

    // 비밀번호 보이기/숨기기
    document.addEventListener('click', (e)=>{
        const btn = e.target.closest('.ap-eye');
        if(!btn) return;
        const input = document.querySelector(btn.dataset.target);
        if(!input) return;
        const isPw = input.type === 'password';
        input.type = isPw ? 'text' : 'password';
        btn.innerHTML = isPw ? '<i class="mdi mdi-eye-off-outline"></i>' : '<i class="mdi mdi-eye-outline"></i>';
    });
</script>

<script>
    function checkId() {
        console.log('gello')

        let user_id = document.getElementById('user_signup_id').value;
        $.ajax({
            url: "/user/checkId",
            type: "GET",
            data: { user_id: user_id },
            dataType: "text",
            success: function(res) {
                const txt = $.trim(res);
                if (txt === "available") {
                    alert("사용 가능한 아이디입니다.");
                    document.getElementById("idChecked").value = "true";   // ★ 여기서 true로 세팅
                } else {
                    alert("이미 존재하는 아이디입니다.");
                    document.getElementById("idChecked").value = "false";
                }
            },
            error: function() {
                alert("아이디 확인 중 오류 발생");
                document.getElementById("idChecked").value = "false";
            }
        });
    }

</script>
<script>
    function signupProc() {
        let user_id = document.getElementById('user_signup_id').value;
        let user_pwd = document.getElementById('user_signup_pwd').value;
        let user_checkPwd = document.getElementById('user_signup_checkpwd').value;
        let user_nick_name = document.getElementById('user_nick_name').value;
        let commute_by_car = document.querySelector('input[name="commute_by_car"]:checked').value;
        let cafe_use_freq = document.getElementById("cafe_use_freq").value;
        let grocery_freq = document.getElementById("grocery_freq").value;
        // 에너지 습관
        let practice_energy_saving = document.querySelector('input[name="practice_energy_saving"]:checked').value;
        // 생활 지역
        let residence_dong = document.getElementById("residence_dong").value;
        let workplace_or_school_dong = document.getElementById("workplace_or_school_dong").value;

        console.log(user_pwd);
        console.log(user_checkPwd);

        if (document.getElementById("idChecked").value !== "true") {
            alert("아이디 중복확인을 해주세요.");
            document.getElementById("user_signup_id").focus();
            return false;
        }


        // ===== 빈칸 처리 =====
        if (user_nick_name.trim() === '') {
            alert('닉네임을 입력해주세요');
            return false;
        } else if (user_id.trim() === '') {
            alert('아이디를 입력해주세요');
            return false;
        } else if (user_pwd.trim() === '') {
            alert('비밀번호를 입력해주세요');
            return false;
        } else if (user_checkPwd.trim() === '') {
            alert('비밀번호 재확인을 입력해주세요');
            return false;
        } else if (user_pwd !== user_checkPwd) {
            alert('비밀번호가 일치하지 않습니다.');
            return false;
        } else if (!commute_by_car) {
            alert('출퇴근 시 자차 이용 여부를 선택해주세요');
            return false;
        } else if (cafe_use_freq.trim() === '') {
            alert('카페 이용 빈도를 선택해주세요');
            return false;
        } else if (grocery_freq.trim() === '') {
            alert('장보기 빈도를 선택해주세요');
            return false;
        } else if (!practice_energy_saving) {
            alert('에너지 절약 실천 여부를 선택해주세요');
            return false;
        } else if (residence_dong.trim() === '') {
            alert('거주 행정동을 입력해주세요');
            return false;
        } else if (workplace_or_school_dong.trim() === '') {
            alert('직장/학교 행정동을 입력해주세요');
            return false;
        }




        $.ajax({
            url: "/user/signUpProc",
            type: "POST",
            data: {
                "user_id": user_id,
                "user_pwd": user_pwd,
                "user_nick_name": user_nick_name,
                "commute_by_car": commute_by_car,
                "cafe_use_freq": cafe_use_freq,
                "grocery_freq": grocery_freq,
                "practice_energy_saving": practice_energy_saving,
                "residence_dong": residence_dong,
                "workplace_or_school_dong": workplace_or_school_dong
            },
            success: function(result) {
                if (result === "success") {
                    alert("회원가입 성공 !!!");
                    window.location.href = '/';
                } else {
                    alert("회원가입 실패: " + result);
                }
            },
            error: function(xhr) {
                console.error("회원가입 에러:", xhr);
                alert("이미 존재하는 아이디입니다.");
            }
        });
    }
</script>
</body>
</html>