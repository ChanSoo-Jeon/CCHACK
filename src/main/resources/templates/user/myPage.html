<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko" th:with="currentTab='home'">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- 반응형 필수 -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>홈</title>

    <!-- page-specific styles only (내비 관련은 포함하지 않음) -->
    <style>
        /* page-specific styles only */
        main.container { padding: 24px 0; }
    </style>

    <style>
        :root { --primary:#5a7dff; --muted:#e9e9ee; --text:#222; }
        body{font-family:system-ui,AppleSDGothicNeo,Segoe UI,Roboto,Arial,sans-serif; color:var(--text); margin:0;}
        .container{max-width: 1080px; margin: 40px auto; padding: 0 16px;}
        h1{font-size: 28px; margin: 8px 0 24px; text-align:center;}
        h2{font-size: 22px; margin: 40px 0 16px;}
        .card{background:#fff; border:1px solid #f0f0f2; border-radius:14px; padding:24px; box-shadow:0 2px 10px rgba(0,0,0,.03);}
        .pill{display:inline-flex; background:var(--muted); border-radius:999px; padding:6px; gap:6px;}
        .pill button{border:0; background:transparent; padding:10px 18px; border-radius:999px; cursor:pointer; color:#777; font-weight:600;}
        .pill button.active{background:var(--primary); color:#fff;}
        .center{display:flex; flex-direction:column; align-items:center; gap:8px; color:#666; margin: 28px 0;}
        .grid{display:grid; grid-template-columns:1fr 1fr; gap:16px;}
        .form-label{font-weight:700; display:block; margin-bottom:6px;}
        .form-control,.form-select{width:100%; border:1px solid #e6e6ea; border-radius:10px; padding:12px 14px; background:#f7f8fb;}
        .btn{display:inline-block; padding:10px 16px; border-radius:10px; border:1px solid #d9d9df; background:#f6f6fa; cursor:pointer;}
        .btn-primary{background:var(--primary); border-color:var(--primary); color:#fff;}
        .row-actions{display:flex; gap:8px; align-items:center;}
        .muted{color:#888; font-size:12px;}
        .hidden{display:none;}
        @media (max-width: 768px){ .grid{grid-template-columns:1fr;} }
    </style>

    <!--추가 스타일-->
    <style>
        /* horizontal scroller */
        .h-scroll{position:relative;margin-top:16px}
        .h-track{
            display:grid; grid-auto-flow:column; grid-auto-columns: 82%;
            gap:14px; overflow-x:auto; overscroll-behavior-x:contain;
            scroll-snap-type:x mandatory; padding:6px 4px 14px;
            scrollbar-width:none;
        }
        .h-track::-webkit-scrollbar{display:none}
        .card-snap{scroll-snap-align:start}
        @media (min-width:900px){ .h-track{grid-auto-columns: 46%} }
        @media (min-width:1200px){ .h-track{grid-auto-columns: 32%} }

        /* card visuals (재사용) */
        .cardX{background:#fff;border:1px solid #f0f0f2;border-radius:14px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,.03)}
        .cardX .media{position:relative;aspect-ratio:16/9;background:#f7f8fb}
        .cardX .media img{width:100%;height:100%;object-fit:cover;display:block}
        .badgeX{position:absolute;top:10px;left:10px;padding:6px 10px;border-radius:999px;font-size:12px;color:#fff;background:#9aa1ff}
        .badgeX.green{background:#22c55e}
        .badgeX.gray{background:#9ca3af}
        .cardX .body{padding:12px 14px 14px}
        .cardX .title{font-weight:800;margin:2px 0 6px}
        .cardX .meta{display:flex;gap:10px;flex-wrap:wrap;color:#777;font-size:12px;margin-bottom:6px}
        .cardX .desc{font-size:14px;color:#333;margin:6px 0 10px;line-height:1.45;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        .cardX .row{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:#555}
        .cardX .actions{display:flex;gap:8px;margin-top:10px}
        .btn-mini{padding:8px 12px;border-radius:10px;border:1px solid #d9d9df;background:#f6f6fa;cursor:pointer}
        .btn-mini.primary{background:var(--primary);border-color:var(--primary);color:#fff}

        /* scroller arrows */
        .h-arrows{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
        .h-arrows .nav{border:0;background:#f2f3f6;border-radius:10px;padding:8px 10px;cursor:pointer}


        /* 폼 레이아웃 개선 */
        .form-grid{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:16px 20px;}
        .form-item{min-width:0; display:flex; flex-direction:column; gap:8px;}
        .form-item.span-2{grid-column:1 / -1;}
        .input,.select{width:100%; min-height:44px; border:1px solid #e6e6ea; border-radius:10px; background:#f7f8fb; padding:10px 14px;}
        .input:focus,.select:focus{outline:none; border-color:#5a7dff; box-shadow:0 0 0 4px rgba(90,125,255,.15);}
        .actions-row{display:flex; gap:8px; justify-content:flex-end; margin-top:20px;}
        @media (max-width:768px){ .form-grid{grid-template-columns:1fr;} }
    </style>
    <style>
        /* 추천: 모든 요소 박스계산 안정화 */
        *, *::before, *::after { box-sizing: border-box; }

        /* 폼 전용 레이아웃 */
        .form-grid{
            display:grid;
            grid-template-columns:repeat(2, minmax(0, 1fr)); /* ← 줄어들 수 있게 */
            gap:16px 20px;
            align-items:start;
        }
        .form-grid > *{ min-width:0; }                    /* ← 셀 내부가 칸을 못 밀게 */
        .form-control, .form-select{ min-width:0; }       /* ← 인풋/셀렉트도 동일 */

        @media (max-width:768px){
            .form-grid{ grid-template-columns:1fr; }
        }
    </style>

    <!---->
    <style>
        .dg-app-nav, .dg-web-nav { width:100%; }
        .row{ display:flex; align-items:center; justify-content:space-between; gap:12px; }

        /* ===== 모바일 네비 (<=640px에서만 표시) ===== */
        .dg-app-nav{ display:none; }              /* 기본 숨김 */
        @media (max-width:640px){
            .dg-app-nav{ display:block; }
        }

        .appbar{
            position:sticky; top:0; z-index:30;
            background:linear-gradient(180deg,#fff,rgba(255,255,255,.92));
            backdrop-filter:blur(6px);
            border-bottom:1px solid var(--line);
        }
        .appbar .row{ padding:10px 14px; }
        .brand{ font-weight:800; color:var(--brand); }
        .menu a{ margin:0 8px; color:#111; font-size:14px; }
        .login a{ color:var(--muted); font-size:14px; }

        /* ===== 웹 네비 (>=768px에서만 표시) ===== */
        .dg-web-nav{ display:none; }              /* 기본 숨김 */
        @media (min-width:768px){
            .dg-web-nav{ display:block; }
        }

        .web-header{
            position:sticky; top:0; z-index:20;
            background:#fff; border-bottom:1px solid var(--line);
        }
        .web-header .row{ max-width:1100px; margin:0 auto; padding:14px 16px; }
        .web-brand{ color:var(--brand); font-weight:800; }
        .web-nav a{ margin:0 12px; color:#111; }
        .web-login{ color:var(--muted); }
        .web-login a{ color:inherit; }

        /* 0) 헤더/앱바 안의 링크 공통 리셋 */
        .web-header a,
        .web-header a:visited,
        .appbar a,
        .appbar a:visited{
            color: inherit;               /* 부모 색상 유지 */
            text-decoration: none;        /* 밑줄 제거 */
        }

        /* 1) 브랜드 로고 색 고정(visited에도 동일) */
        .web-brand a,
        .web-brand a:visited,
        .brand a,
        .brand a:visited{
            color: var(--brand);
        }

        /* 2) 웹 메뉴 링크 색 고정 */
        .web-nav a,
        .web-nav a:visited{ color:#111; }

        /* 3) 우측 로그인/유저 영역 색(웹) */
        .web-login,
        .web-login a,
        .web-login a:visited{ color: var(--muted); }

        /* (선택) 호버 시만 밑줄 */
        .web-header a:hover,
        .appbar a:hover{ text-decoration: underline; }
    </style>
</head>
<body>
<!--네비-->
<div class="dg-app-nav">
    <div class="appbar">
        <div class="row">
            <div class="brand"><a href="/user">동구라미 온</a></div>

            <div class="menu">
                <a href="/trash/reportPage">지도</a>
                <a href="#">참여</a>
                <a href="#">센터</a>
                <a href="#">정보</a>
            </div>

            <div class="login">
                <!-- 로그인 전 -->
                <a th:if="${#strings.isEmpty(session.user_id)}" th:href="@{/user/login}">로그인</a>

                <!-- 로그인 후 -->
                <a th:unless="${#strings.isEmpty(session.user_id)}" th:href="@{/user/myPage}">내 정보</a>
            </div>
        </div>
    </div>
</div>

<!-- 웹 네비: 768px 이상에서만 보임 -->
<div class="dg-web-nav">
    <header class="web-header">
        <div class="row">
            <div class="web-brand"><a href="/user">동구라미 온</a></div>

            <nav class="web-nav">
                <a href="/trash/reportPage">지도</a>
                <a href="#">참여</a>
                <a href="#">센터</a>
                <a href="#">정보</a>
            </nav>

            <!-- 로그인 전 -->
            <a class="web-login" th:if="${#strings.isEmpty(session.user_id)}" th:href="@{/user/login}">로그인</a>

            <!-- 로그인 후 -->
            <div class="web-login" th:unless="${#strings.isEmpty(session.user_id)}">
                <a th:href="@{/user/myPage}">내 정보</a>
                <span aria-hidden="true"> | </span>
                <a th:href="@{/user/logOut}">로그아웃</a>
            </div>
        </div>
    </header>
</div>

<!---->

<div class="container">

    <!-- 내 신고해결 -->
    <h1>내 신고해결</h1>
    <div class="card" id="reportSection">
        <div class="pill" role="tablist" aria-label="신고/해결 전환">
            <button id="tab-report" class="active" aria-selected="true">신고</button>
            <button id="tab-resolved" aria-selected="false">해결</button>
        </div>

        <!-- 신고 탭 컨텐츠 -->
        <div id="pane-report" class="pane">
            <!-- 빈 상태 -->
            <div class="center" th:if="${#lists.isEmpty(rList)}">
                <img th:src="@{/img/empty-note.png}" alt="" width="120" height="120" onerror="this.style.display='none'">
                <div>신고 내역이 없어요</div>
            </div>

            <!-- 리스트 -->
            <div class="h-scroll" th:if="${!#lists.isEmpty(rList)}">
                <div class="h-track" id="trackReport">
                    <article class="cardX card-snap" th:each="r : ${rList}">
                        <div class="media">
                            <img th:src="${r.image_url}" alt="">
                            <span class="badgeX"
                                  th:text="${r.status} ? '해결완료' : '신고접수'"
                                  th:classappend="${r.status} ? ' green' : ''"></span>
                        </div>
                        <div class="body">
                            <div class="title" th:text="${r.title}">제목</div>
                            <div class="meta">
<!--                                <span th:text="${r.addr}">주소</span>-->
                                <span th:text="${#temporals.format(r.created_at,'yyyy.MM.dd HH:mm')}">날짜</span>
                            </div>
                            <p class="desc" th:text="${r.description}">설명</p>
                            <div class="row">
                                <span>포인트 <b th:text="${r.point}">0</b></span>
                                <span>#<b th:text="${r.report_id}">-</b></span>
                            </div>
                        </div>
                    </article>
                </div>
                <div class="h-arrows">
                    <button class="nav" data-target="#trackReport" data-dir="-1">◀</button>
                    <button class="nav" data-target="#trackReport" data-dir="1">▶</button>
                </div>
            </div>
        </div>

        <!-- 해결 탭 컨텐츠 -->
        <div id="pane-resolved" class="pane hidden">
            <!-- 빈 상태 -->
            <div class="center" th:if="${#lists.isEmpty(sList)}">
                <img th:src="@{/img/empty-note.png}" alt="" width="120" height="120" onerror="this.style.display='none'">
                <div>해결된 내역이 없어요</div>
            </div>

            <!-- 리스트 -->
            <div class="h-scroll" th:if="${!#lists.isEmpty(sList)}">
                <div class="h-track" id="trackSolved">
                    <article class="cardX card-snap" th:each="s : ${sList}">
                        <div class="media">
                            <img th:src="${s.proof_image_url != null ? s.proof_image_url : s.image_url}" alt="">
                            <span class="badgeX green">해결완료</span>
                        </div>
                        <div class="body">
                            <div class="title" th:text="${s.title}">제목</div>
                            <div class="meta">
<!--                                <span th:text="${s.addr}">주소</span>-->
                                <span th:text="${#temporals.format(s.solved_at,'yyyy.MM.dd HH:mm')}">해결일</span>
                            </div>
                            <p class="desc" th:text="${s.note != null ? s.note : '메모 없음'}">메모</p>
                            <div class="row">
                                <span>해결자 <b th:text="${s.resolver_id}">나</b></span>
                                <span>#<b th:text="${s.report_id}">-</b></span>
                            </div>
                        </div>
                    </article>
                </div>
                <div class="h-arrows">
                    <button class="nav" data-target="#trackSolved" data-dir="-1">◀</button>
                    <button class="nav" data-target="#trackSolved" data-dir="1">▶</button>
                </div>
            </div>
        </div>
    </div>

    <h2>정보수정</h2>
    <div class="card">
        <form id="mypageForm" onsubmit="return false;">
            <div class="form-grid">

                <!-- 1행 -->
                <div class="form-item">
                    <label class="form-label" for="user_nick_name">닉네임</label>
                    <input id="user_nick_name" name="user_nick_name" class="input" placeholder="닉네임 입력" th:value="${uDTO.user_nick_name}">
                </div>
                <div class="form-item">
                    <label class="form-label" for="residence_dong">거주 행정동</label>
                    <input id="residence_dong" name="residence_dong" class="input" placeholder="예: 서울 강남구 역삼동" th:value="${uDTO.residence_dong}">
                </div>
                <div class="form-item">
                    <label class="form-label" for="workplace_or_school_dong">직장/학교 행정동</label>
                    <input id="workplace_or_school_dong" name="workplace_or_school_dong" class="input" placeholder="예: 서울 서초구 서초동" th:value="${uDTO.workplace_or_school_dong}">
                </div>

                <!-- 3행 -->
                <div class="form-item">
                    <label class="form-label" for="commute_by_car">자가용 출퇴근</label>
                    <select id="commute_by_car" name="commute_by_car" class="select">
                        <option value="true">예</option>
                        <option value="false">아니오</option>
                    </select>
                </div>
                <div class="form-item">
                    <label class="form-label" for="cafe_use_freq">카페 이용 빈도</label>
                    <select id="cafe_use_freq" name="cafe_use_freq" class="select">
                        <option>주 1회</option><option>주 3회</option><option>매일</option>
                    </select>
                </div>

                <!-- 4행 -->
                <div class="form-item">
                    <label class="form-label" for="grocery_freq">장보기 빈도</label>
                    <select id="grocery_freq" name="grocery_freq" class="select">
                        <option>주 1회</option><option>주 2회</option><option>필요시</option>
                    </select>
                </div>
                <div class="form-item">
                    <label class="form-label" for="practice_energy_saving">에너지 절약 실천</label>
                    <select id="practice_energy_saving" name="practice_energy_saving" class="select">
                        <option value="true">예</option><option value="false">아니오</option>
                    </select>
                </div>

                <!-- 필요 시 전체폭 필드 -->
                <!-- <div class="form-item span-2"> ... </div> -->

            </div>

            <div class="actions-row">
                <button type="button" class="btn" id="btnCancel">취소</button>
                <button type="button" class="btn btn-primary" id="btnSave">저장</button>
            </div>
        </form>
    </div>
</div>

<!-- (선택) jQuery
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
-->

<script>
    // --- 신고/해결 탭 전환 ---
    const tabReport   = document.getElementById('tab-report');
    const tabResolved = document.getElementById('tab-resolved');
    const paneReport  = document.getElementById('pane-report');
    const paneResolved= document.getElementById('pane-resolved');

    function activate(tab){
        if(tab==='report'){
            tabReport.classList.add('active'); tabReport.setAttribute('aria-selected','true');
            tabResolved.classList.remove('active'); tabResolved.setAttribute('aria-selected','false');
            paneReport.classList.remove('hidden'); paneResolved.classList.add('hidden');
        }else{
            tabResolved.classList.add('active'); tabResolved.setAttribute('aria-selected','true');
            tabReport.classList.remove('active'); tabReport.setAttribute('aria-selected','false');
            paneResolved.classList.remove('hidden'); paneReport.classList.add('hidden');
        }
    }
    tabReport.addEventListener('click', ()=>activate('report'));
    tabResolved.addEventListener('click', ()=>activate('resolved'));

    // --- 정보 저장(예시: Ajax 연동 지점) ---
    document.getElementById('btnSave').addEventListener('click', function(){
        // TODO: 값 수집 후 Ajax로 /mypage/update 같은 엔드포인트 호출
        // 예) const payload = { user_nick_name: document.getElementById('user_nick_name').value, ... };
        alert('저장 로직을 연결하세요.');
    });

    document.getElementById('btnCancel').addEventListener('click', function(){
        history.back(); // 필요 시 변경
    });
</script>
<!--추가 스크립트-->
<script>
    // 좌우 버튼 스크롤
    document.querySelectorAll('.h-arrows .nav').forEach(btn=>{
        btn.addEventListener('click', ()=>{
            const track = document.querySelector(btn.dataset.target);
            const dir = Number(btn.dataset.dir);
            const delta = Math.round(track.clientWidth * 0.9) * dir; // 90% 폭씩
            track.scrollBy({left: delta, behavior: 'smooth'});
        });
    });

    // (선택) 드래그로 스크롤
    ['trackReport','trackSolved'].forEach(id=>{
        const el = document.getElementById(id);
        if(!el) return;
        let isDown=false,startX,scrollLeft;
        el.addEventListener('pointerdown',e=>{isDown=true;startX=e.pageX;scrollLeft=el.scrollLeft;el.setPointerCapture(e.pointerId);});
        el.addEventListener('pointermove',e=>{if(!isDown) return; el.scrollLeft = scrollLeft - (e.pageX-startX);});
        ['pointerup','pointerleave'].forEach(ev=>el.addEventListener(ev,()=>{isDown=false;}));
    });

    // 해결 모달 (예시)
    function openSolveModal(button){
        const id = button.getAttribute('data-id');
        // TODO: 모달 열기 로직 연결
        console.log('solve report', id);
    }
</script>
</body>
</html>
