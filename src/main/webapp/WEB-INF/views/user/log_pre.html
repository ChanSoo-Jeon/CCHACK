<!-- <%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%> -->
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Loginpage</title>
<link
	href="https://fonts.googleapis.com/css?family=Karla:400,700&display=swap"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdn.materialdesignicons.com/4.8.95/css/materialdesignicons.min.css">
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-4 login-section-wrapper">
				</div>
				<div class="login-wrapper my-auto">
					<div>
						<button id="loginButton" style="border: 0; background: none;"
							onclick="signIn()" disabled>
							<h1 class="login-title" id="loginFont" style="color: #000;">SIGN
								IN</h1>
						</button>
						<button id="signupButton" style="border: 0; background: none;"
							onclick="signUp()">
							<h1 class="login-title" id="signupFont" style="color: #ced4da;">SIGN UP</h1>
						</button>
					</div>
					<div id="loginPage">
                        <form id="loginForm">
							<div class="form-group">
								<label for="email">아이디</label> <input name="user_id" id="user_id"
									class="form-control" placeholder="enter your ID">
							</div>
							<div class="form-group mb-4">
								<label for="password">비밀번호</label> <input type="password"
									name="user_pwd" id="user_pwd" class="form-control"
									placeholder="enter your passsword">
							</div>
							<input name="login" class="btn btn-block login-btn" type="button"
								value="Login" onclick="loginProc();">
                        </form>
					</div>

					<div id="signupPage" style="display: none">
						<div class="form-group">
							<label for="email">아이디</label> <input name="signupId"
								id="user_signup_id" class="form-control" placeholder="enter your ID">
                            <div class="input-group">
                                <button type="button" id="btnCheckId" class="btn btn-outline-secondary" onclick="checkId();">중복확인</button>
                            </div>

                            <small id="idHelp" class="form-text"></small>
                            <!-- 중복확인 완료 여부를 보관하는 hidden 필드 -->
                            <input type="hidden" id="idChecked" value="false">


						</div>
						<div class="form-group mb-4">
							<label for="password">비밀번호</label> <input type="password"
								name="signupPwd" id="user_signup_pwd" class="form-control"
								placeholder="enter your passsword">
						</div>
						<div class="form-group mb-4">
							<label for="password">비밀번호 재확인</label> <input type="password"
								name="checkPwd" id="user_signup_checkpwd" class="form-control"
								placeholder="check your passsword">
						</div>

                        <hr class="my-4">

                        <!-- 추가: 유저 닉네임 -->
                        <div class="form-group">
                            <label for="user_nick_name">닉네임</label>
                            <input name="user_nick_name" id="user_nick_name" class="form-control" placeholder="예: 그린워커">
                        </div>

                        <!-- 추가: 교통 습관 (자차 출퇴근 여부) -->
                        <div class="form-group">
                            <label class="d-block">출퇴근 시 자차 이용 여부</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="commute_by_car" id="commute_by_car_yes" value="true">
                                <label class="form-check-label" for="commute_by_car_yes">예</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="commute_by_car" id="commute_by_car_no" value="false" checked>
                                <label class="form-check-label" for="commute_by_car_no">아니오</label>
                            </div>
                        </div>

                        <!-- 추가: 소비 습관 - 카페 이용 빈도 -->
                        <div class="form-group">
                            <label for="cafe_use_freq">카페 이용 빈도</label>
                            <select name="cafe_use_freq" id="cafe_use_freq" class="form-control">
                                <option value="" selected disabled>선택하세요</option>
                                <option value="거의 안 감">거의 안 감</option>
                                <option value="월1~2회">월 1~2회</option>
                                <option value="주1~2회">주 1~2회</option>
                                <option value="주3회 이상">주 3회 이상</option>
                            </select>
                        </div>

                        <!-- 추가: 소비 습관 - 장보기 빈도 -->
                        <div class="form-group">
                            <label for="grocery_freq">장보기 빈도</label>
                            <select name="grocery_freq" id="grocery_freq" class="form-control">
                                <option value="" selected disabled>선택하세요</option>
                                <option value="거의 안 감">거의 안 감</option>
                                <option value="월1회">월 1회</option>
                                <option value="주1회">주 1회</option>
                                <option value="주2회 이상">주 2회 이상</option>
                            </select>
                        </div>

                        <!-- 추가: 에너지 절약 실천 여부 -->
                        <div class="form-group">
                            <label class="d-block">에너지 절약 실천 여부</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="practice_energy_saving" id="practice_energy_saving_yes" value="true">
                                <label class="form-check-label" for="practice_energy_saving_yes">예</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="practice_energy_saving" id="practice_energy_saving_no" value="false" checked>
                                <label class="form-check-label" for="practice_energy_saving_no">아니오</label>
                            </div>
                        </div>

                        <!-- 추가: 생활 지역 - 거주 행정동 -->
                        <div class="form-group">
                            <label for="residence_dong">거주 행정동</label>
                            <input name="residence_dong" id="residence_dong" class="form-control" placeholder="예: 효자동">
                        </div>

                        <!-- 추가: 생활 지역 - 직장/학교 행정동 -->
                        <div class="form-group">
                            <label for="workplace_or_school_dong">직장/학교 행정동</label>
                            <input name="workplace_or_school_dong" id="workplace_or_school_dong" class="form-control" placeholder="예: 석사동">
                        </div>



						<input name="login" class="btn btn-block login-btn" type="button"
							value="SignUp" onclick="signupProc()">
					</div>
				</div>
			</div>
			<div class="col-sm-8 px-0 d-none d-sm-block">
				<img src="/assets/images/healingMain.jpg" alt="login image"
					class="login-img">
			</div>
		</div>
	</div>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
	<script
		src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
	<script>
		function signIn() {
			document.getElementById('loginPage').style = "";
			document.getElementById('signupPage').style = "display:none";
			document.getElementById('loginFont').style = "color:#000";
			document.getElementById('signupFont').style = "color:#ced4da";
			let button_a = document.getElementById('loginButton');
			let button_b = document.getElementById('signupButton');

			button_a.disabled = true;
			button_b.disabled = false;
		}
		function signUp() {
			document.getElementById('loginPage').style = "display:none";
			document.getElementById('signupPage').style = ""
			document.getElementById('loginFont').style = "color:#ced4da";
			document.getElementById('signupFont').style = "color:#000";
			let button_a = document.getElementById('loginButton');
			let button_b = document.getElementById('signupButton');

			button_a.disabled = false;
			button_b.disabled = true;
		}
	</script>
    <script>
        function loginProc() {

            var user_id = document.getElementById("user_id").value;
            var user_pwd =document.getElementById("user_pwd").value;

            $.ajax({
                url: "/user/loginProc",
                type: "POST",
                data: {"user_id": user_id, "user_pwd": user_pwd},
                success: function (result) {
                    if(result === "success"){
                        if (window.parent && window.parent.closeLoginModal) {
                            window.parent.closeLoginModal();
                            window.parent.location.reload();
                        }
                    } else {
                        alert("로그인 실패");
                    }
                },
                error: function (e) {
                    alert('이미 존재하는 아이디입니다.');
                }
            });
        }
    </script>
    <script>
        function checkId() {
            console.log('gello')

            let user_id = document.getElementById('user_signup_id').value;
            $.ajax({
                url: "/user/checkId",
                type: "GET",
                data: { user_id: user_id },
                dataType: "text",
                success: function(res) {
                    const txt = $.trim(res);
                    if (txt === "available") {
                        alert("사용 가능한 아이디입니다.");
                        document.getElementById("idChecked").value = "true";   // ★ 여기서 true로 세팅
                    } else {
                        alert("이미 존재하는 아이디입니다.");
                        document.getElementById("idChecked").value = "false";
                    }
                },
                error: function() {
                    alert("아이디 확인 중 오류 발생");
                    document.getElementById("idChecked").value = "false";
                }
            });
        }

    </script>
	<script>
	function signupProc() { 
		let user_id = document.getElementById('user_signup_id').value;
		let user_pwd = document.getElementById('user_signup_pwd').value;
		let user_checkPwd = document.getElementById('user_signup_checkpwd').value;
		let user_nick_name = document.getElementById('user_nick_name').value;
        let commute_by_car = document.querySelector('input[name="commute_by_car"]:checked').value;
        let cafe_use_freq = document.getElementById("cafe_use_freq").value;
        let grocery_freq = document.getElementById("grocery_freq").value;
        // 에너지 습관
        let practice_energy_saving = document.querySelector('input[name="practice_energy_saving"]:checked').value;
        // 생활 지역
        let residence_dong = document.getElementById("residence_dong").value;
        let workplace_or_school_dong = document.getElementById("workplace_or_school_dong").value;

		console.log(user_pwd);
		console.log(user_checkPwd);

        if (document.getElementById("idChecked").value !== "true") {
            alert("아이디 중복확인을 해주세요.");
            document.getElementById("user_signup_id").focus();
            return false;
        }


        // ===== 빈칸 처리 =====
        if (user_nick_name.trim() === '') {
            alert('닉네임을 입력해주세요');
            return false;
        } else if (user_id.trim() === '') {
            alert('아이디를 입력해주세요');
            return false;
        } else if (user_pwd.trim() === '') {
            alert('비밀번호를 입력해주세요');
            return false;
        } else if (user_checkPwd.trim() === '') {
            alert('비밀번호 재확인을 입력해주세요');
            return false;
        } else if (user_pwd !== user_checkPwd) {
            alert('비밀번호가 일치하지 않습니다.');
            return false;
        } else if (!commute_by_car) {
            alert('출퇴근 시 자차 이용 여부를 선택해주세요');
            return false;
        } else if (cafe_use_freq.trim() === '') {
            alert('카페 이용 빈도를 선택해주세요');
            return false;
        } else if (grocery_freq.trim() === '') {
            alert('장보기 빈도를 선택해주세요');
            return false;
        } else if (!practice_energy_saving) {
            alert('에너지 절약 실천 여부를 선택해주세요');
            return false;
        } else if (residence_dong.trim() === '') {
            alert('거주 행정동을 입력해주세요');
            return false;
        } else if (workplace_or_school_dong.trim() === '') {
            alert('직장/학교 행정동을 입력해주세요');
            return false;
        }




        $.ajax({
            url: "/user/signUpProc",
            type: "POST",
            data: {
                "user_id": user_id,
                "user_pwd": user_pwd,
                "user_nick_name": user_nick_name,
                "commute_by_car": commute_by_car,
                "cafe_use_freq": cafe_use_freq,
                "grocery_freq": grocery_freq,
                "practice_energy_saving": practice_energy_saving,
                "residence_dong": residence_dong,
                "workplace_or_school_dong": workplace_or_school_dong
            },
            success: function(result) {
                if (result === "success") {
                    if (window.parent && window.parent.closeLoginModal) {
                        window.parent.closeLoginModal();
                        window.parent.location.reload();
                    }
                } else {
                    alert("회원가입 실패: " + result);
                }
            },
            error: function(xhr) {
                console.error("회원가입 에러:", xhr);
                alert("이미 존재하는 아이디입니다.");
            }
        });
	}
	</script>
</body>
</html>